!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n){function e(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function r(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function o(t,n){return t+(n-t)*Math.random()}function a(t,n){var e=this;this.n_rows=t,this.n_cols=n,this.data=new Array(t),this.data.fill(1,0,t),this.data=this.data.map((function(t){return new Array(n)})),this.data=this.data.map((function(t){return t.fill(1,0,n).map((function(t){return o(-2,2)}))})),this.copyColumn=function(t,n){if(!(e.n_rows===t.n_rows&&n<t.n_cols))throw new Error("Matrix should have n_rows for copying a column");for(var r=0;r<t.n_rows;r++)e.data[r][n]=t.data[r][n]}}function u(t,n){var e=new a(t.n_rows,t.n_cols);for(i=0;i<t.n_rows;i++)for(j=0;j<t.n_cols;j++)e.data[i][j]=n*t.data[i][j];return e}function s(t,n){if(t.n_rows!==n.n_rows||t.n_cols!==n.n_cols)throw new Error("Matrix dimentions dont match for addition");for(var e=t.data,r=n.data,o=new a(t.n_rows,t.n_cols),i=0;i<t.n_rows;i++)for(var u=0;u<t.n_cols;u++)o.data[i][u]=e[i][u]+r[i][u];return o}function c(t,n,e){this.size=t,this.outputSize=n,this.activation=e,this.weights=new a(n,t),this.bias=new a(n,1),this.activation=e,this.compute=function(t){var n=function(t,n){var e=t.data,r=n.data;if(t.n_cols!==n.n_rows)throw new Error("Matrix dimensions dont match for multiplication.");for(var o=new a(t.n_rows,n.n_cols),i=0;i<t.n_rows;i++)for(var u=0;u<n.n_cols;u++){for(var s=0,c=0;c<t.n_cols;c++)s+=e[i][c]*r[c][u];o.data[i][u]=s}return o}(this.weights,t);return this.activation(s(n,this.bias))}}function l(t){for(var n=new a(t.n_rows,t.n_cols),e=0;e<t.n_rows;e++)for(var r=0;r<t.n_cols;r++)n.data[e][r]=Math.max(0,t.data[e][r]);return n}function f(t){for(var n=new a(t.n_rows,t.n_cols),e=0;e<t.n_rows;e++)for(var r=0;r<t.n_cols;r++)n.data[e][r]=1/(1+Math.exp(-t.data[e][r]));return n}function p(t){this.layers=t,this.feedFoward=function(t){return this.layers.reduce((function(t,n){return n.compute(t)}),t)}}function h(t){this.representation=t,this.fitScore=0,this.setFitness=function(t){this.fitScore=t},this.mate=function(t){for(var n=this.representation,e=t.representation,r=this.representation.layers.length,i=(this.fitScore,t.fitScore,[]),a=0;a<r;a++){for(var l=n.layers[a],f=e.layers[a],d=new c(l.size,l.outputSize,l.activation),w=0,v=0,y=0;y<l.size;y++){var g=60*Math.random()-30;if(g<.45)d.weights.copyColumn(l.weights,y),w+=1;else if(g<.9)d.weights.copyColumn(f.weights,y),v+=1;else for(var m=d.weights.data,_=0;_<m.length;_++)m[_][y]=.25*l.weights.data[_][y]+.25*f.weights.data[_][y]+.5*o(-50,50)}d.bias=s(u(l.bias,w/(w+v)),u(f.bias,v/(w+v))),i.push(d)}return new h(new p(i))}}var d=document.getElementById("canvas").getContext("2d");function w(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return e+o(.1,.5)*n}d.fillStyle="green",d.fillRect(0,0,30,30);var v=60,y=new Array(v).fill(0,0,v),g=0;var m=new Array(v).fill(1,0,v).map((function(t){return new h(new p([new c(4,5,f),new c(5,12,l),new c(12,1,f)]))}));!function t(n){var o=n.populationSize,i=new Array(o).fill({x:100,y:225,vy:0},0,o);i=i.map((function(t,n){return function(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(n){r(t,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))}))}return t}({},t,{y:t.y-n})}));var u=[{x:900,center:w(150,450)},{x:1350,center:w(150,450)}],s=0,c=setInterval((function(){var e=function(t,n){return t.map((function(t){if(t.dead)return!0;if(t.y-20<=0)return!0;if(t.y+20>=450)return!0;var e=n[0];return t.x+20>=e.x&&t.x-20<=e.x+55&&(t.y-20<=e.center-75||t.y+20>=e.center+75)}))}(i,u);if((y=y.map((function(t,n){return 0===t&&e[n]?(i[n].dead=!0,s):t}))).reduce((function(t,n){return t&&n}),1))return clearInterval(c),!0,console.log("Geneation #"+g,y),n.runIteration(y,g++),y.fill(0,0,v),void t(n);d.clearRect(0,0,canvas.width,canvas.height);var r=[];i.forEach((function(t,e){if(t.dead)t.x+=-1;else{t.vy+=.1,t.y+=t.vy;var o=u[0].x-t.x,i=new a(4,1);i.data=[[Math.max(0,o)],[t.y],[.05*t.vy],[u[0].center-t.y]];var s=n.population[e].representation.feedFoward(i);r.push(s.data[0][0]),(s=s.data[0][0])<.5&&(t.vy=-4)}})),(u=u.map((function(t){return{x:t.x+=-1,center:t.center}})))[0].x+55<=0&&(u.splice(0,1),u.push({x:927.5,center:w(150,450)}),s+=2e3),u.forEach((function(t){d.fillStyle="green",d.fillRect(t.x,0,55,t.center-75),d.fillRect(t.x,t.center+75,55,450-t.center)})),d.beginPath(),i.forEach((function(t){var n,e,r;n=t.x,e=t.y,r=20,d.moveTo(n+r,e),d.arc(n,e,r,0,2*Math.PI)})),d.closePath(),d.fillStyle="rgba(193, 35, 35, 0.5)",d.strokeStyle="#003300",d.fill(),d.stroke(),s++}),10)}(new function t(n,e,i,a){var u=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"runIteration",(function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(u.population.forEach((function(n,e){return n.setFitness(t[e])})),u.population=u.population.sort((function(t,n){return t.fitScore<n.fitScore?-1:(t.fitScore,n.fitScore,1)})),console.log("Best solution is : ",u.population[u.populationSize-1]),u.population[u.populationSize-1].fitScore>u.target)console.log("Best solution is : ",u.population[u.populationSize-1]);else{for(var n=[],e=u.populationSize-1;n.length<=u.ellitism*u.populationSize;e--)n.push(u.population[e]);for(var r=n.length;r<u.populationSize;r=n.length){Math.floor(o(.5*u.populationSize,u.populationSize));var i=Math.floor(o(.5*u.populationSize,u.populationSize)),a=u.population[u.populationSize-1].mate(u.population[i]);n.push(a)}u.population=n}})),this.populationSize=n,this.population=e,this.ellitism=i,this.target=a}(v,m,.2,3e5))}]);